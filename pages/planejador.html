<html>
<head>

    <title>Virada Cultural</title>
    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">

    <!-- Evitar problemas com caracteres latinos -->
    <meta charset="UTF-8">

    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link type="text/css" rel="stylesheet" href="../ratchet-2.0.2/dist/css/ratchet.min.css"/>
    <link type="text/css" rel="stylesheet" href="../font-awesome-4.7.0/css/font-awesome.min.css" />
    <script src="../ratchet-2.0.2/dist/js/ratchet.min.js"></script>

    <script src="../js/notification.js"></script>

    <link rel="stylesheet" href="css/base.css" />

    <link rel="stylesheet" href="css/planejador.css" />
</head>

<body>
<header class="bar bar-nav">
    <a class="icon icon-left-nav pull-left" style="color:white" onclick="history.back();"></a>
    <h1 class="title">Planejador</h1>
    <a class="icon pull-right" href="#modalAjuda"><span class="fa fa-question" style="color: white;"></span></a>
</header>
<div class="content">
    <button id="menu-trigger" class="menu-trigger"><span class="fa fa-circle"></span></button>
    <ul class="planning">
        <li>
            <img src="/virada-cultural/images/anitta.jpg" class="show-pic" />
            <div class="show-desc">
                <label class="show-hour">19:00 - 20:30</label>
                <label>Show da Anitta</label>
                <label>Palco Arouche</label>
            </div>
        </li>
        <li id="add-event" class="add-event-item">
            <a href="#modalAtracao">
                <div class="show-pic">
                    <span class="add-event-btn fa fa-plus-circle"></span>
                </div>
                <div class="show-desc add-event-text">
                    <label class="add-event-desc">Adicionar uma atividade</label>
                </div>
            </a>
        </li>
    </ul>
    <div id="modalAtracao" class="modal">
        <header class="bar bar-nav">
            <a class="icon icon-close pull-right" href="#modalAtracao"></a>
            <h1 class="title">Nova atividade</h1>
        </header>

        <div class="content">
            <input type="search" id="search" class="event-search" placeholder="Pesquisar por nome da atração ou local">
            <ul class="table-view">
                <li class="table-view-cell media" id="evento-1" name="event">
                    <a class="navigate-right add-event-link">
                        <img class="media-object pull-left" src="http://placehold.it/42x42">
                        <div class="media-body" data-img="/virada-cultural/images/anitta.jpg" id="atracao-1">
                            <label class="show-hour">15:00-15:45</label>
                            <label class="show-name">Show da Carreta Furacão</label>
                            <label class="show-place">Local: Morumbi</label>
                            <p class="activity-text">
                                Sucesso no Brasil todo, o grupo vai realizar um
                                show de dança moderno, cheio de acrobacia e gingado.
                            </p>
                        </div>
                    </a>
                </li>
                <li class="table-view-cell media" id="evento-2" name="event">
                    <a class="navigate-right add-event-link">
                        <img class="media-object pull-left" src="http://placehold.it/42x42">
                        <div class="media-body" data-img="/virada-cultural/images/anitta.jpg" id="atracao-2">
                            <label class="show-hour">15:00-15:45</label>
                            <label class="show-name">Banda Uó</label>
                            <label class="show-place">Local: Morumbi</label>
                            <p class="activity-text">
                                Sucesso no Brasil todo, o grupo vai realizar um
                                show de dança moderno, cheio de acrobacia e gingado.
                            </p>
                        </div>
                    </a>
                </li>
                <li class="table-view-cell media" id="evento-3" name="event">
                    <a class="navigate-right add-event-link">
                        <img class="media-object pull-left" src="http://placehold.it/42x42">
                        <div class="media-body" data-img="/virada-cultural/images/anitta.jpg" id="atracao-3">
                            <label class="show-hour">Dia todo</label>
                            <label class="show-name">Alcione</label>
                            <label class="show-place">Local: Butantã</label>
                            <p class="activity-text">
                                Sucesso no Brasil todo, o grupo vai realizar um
                                show de dança moderno, cheio de acrobacia e gingado.
                            </p>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Ajuda -->
    <div id="modalAjuda" class="modal">
        <header class="bar bar-nav help-nav">
            <a class="icon icon-close pull-right" href="#modalAjuda"></a>
            <h1 class="title">Ajuda</h1>
        </header>
        <div class="content">
            <div class="help-content">
                <details>
                    <summary>Como funciona o planejador?</summary>
                    <p>
                        O planejador usa o cronograma da virada para você
                        conseguir organizar o evento da melhor forma possível.
                        Procure atrações pelo nome ou local, planeje seu horário
                        e depois você pode compartilhar suas informações com
                        os demais participantes da virada.
                    </p>
                </details>

                <details>
                    <summary>Como crio o meu cronograma?</summary>
                    <p>
                        Você pode adicionar novas atrações usando o botão
                        "Adicionar uma atividade". Escolha uma das atrações ou
                        pesquise elas por nome ou local onde acontecerão.
                    </p>
                </details>

                <details>
                    <summary>Que informações estão disponíveis sobre as atrações?</summary>
                    <p>
                        Você pode ver o nome da atração, horário, local e a descrição da atração.
                    </p>
                </details>

                <details>
                    <summary>Qualquer um pode ver meu cronograma?</summary>
                    <p>
                        Você escolhe quem pode ver seu cronograma pelas configurações no seu
                        perfil.
                    </p>
                </details>

                <details>
                    <summary>Se eu marcar que vou numa atração, estou reservando lugar?</summary>
                    <p>
                        Não, mas essa informação é usada para organização logística do evento.
                        Se você souber que não vai a uma atração, remova-a do seu cronograma por favor.
                    </p>
                </details>
            </div>
        </div>
    </div>

    <script class="js-custom">
        var list = document.querySelector('.planning');
        var addButton = document.getElementById('add-event');
        var modal = document.getElementById('modalAtracao');

        function createEventItem(name, hour, place, imgSrc) {
            var elementString = `
                <li>
                    <img src="${imgSrc}" class="show-pic" />
                    <div class="show-desc">
                        <label class="show-hour">${hour}</label>
                        <label>${name}</label>
                        <label>${place}</label>
                    </div>
                </li>`;

            var div = document.createElement('div');
            div.innerHTML = elementString;
            return div.firstElementChild;
        }

        function addEvent(id) {
            var container = document.getElementById(id);
            var data = container.querySelector('.media-body');
            var hour = data.querySelector('.show-hour').innerText;
            var name = data.querySelector('.show-name').innerText;
            var place = data.querySelector('.show-place').innerText;
            var imgSrc = data.getAttribute('data-img');

            // Cria o elemento e adiciona no planejamento
            var item = createEventItem(name, hour, place, imgSrc);
            list.insertBefore(item, addButton);

            // Remove o evento da lista de disponíveis
            container.parentNode.removeChild(container);

            modal.classList.remove('active');
        }

        document.querySelectorAll('.add-event-link').forEach(function (e, index) {
            e.addEventListener('touchend', function () {
                addEvent(`evento-${index + 1}`);
            });
        });

        var shownElements = [];

        // Funcionalidade de pesquisa
        function search(text) {
            document.querySelectorAll('.show-name').forEach(function (element) {
                searchInElement(element, text);
            });
            document.querySelectorAll('.show-place').forEach(function (element) {
                searchInElement(element, text);
            });
        }

        function searchInElement(element, text) {
            if (element.innerText.toLowerCase().indexOf(text) >= 0) {
                var elementFound = element.parentNode;
                if (shownElements.indexOf(elementFound) < 0) {
                    shownElements.push(elementFound);
                }
            }
        }

        function findContainer(element) {
            while (element.getAttribute('name') != 'event') {
                element = element.parentNode;
            }
            return element;
        }

        function setFoundElementsDisplay(display) {
            shownElements.forEach(function (element) {
                findContainer(element).style.display = display;
            })
        }

        function setAllElementsDisplay(display) {
            document.querySelectorAll('.show-name').forEach(function (element) {
                findContainer(element).style.display = display;
            });
        }

        var searchField = document.getElementById('search');
        searchField.addEventListener('keyup', function () {
            var text = searchField.value;
            shownElements = [];

            if (text === '') {
                setAllElementsDisplay('block');
            } else {
                search(text.toLowerCase());
                setAllElementsDisplay('none');
                setFoundElementsDisplay('block');
            }
        });
    </script>
</div>
</body>
</html>
<script src="../js/os.js"></script>
<script src="../js/menu.js"></script>
